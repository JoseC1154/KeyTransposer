<!-- FILE: index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
  <meta name="theme-color" content="#121212" />
  <title>Piano Chord Transposer</title>

  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="styles.css" />

  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
</head>
<body>

  <!-- ===== TOP BAR ===== -->
  <header class="topbar" id="topbar">
  <div class="leftGroup">
    <button class="ghost" id="btnMenu" type="button" aria-haspopup="dialog" aria-controls="menuModal" aria-label="Menu">â˜°</button>
    <div class="brand">
      <span class="dot"></span>
      <div class="titles">
        <div class="appname">Piano Chord Transposer</div>
        <div class="subtitle" id="chordNameText">Chord: â€”</div>
      </div>
      <div class="hud">
        <div class="hudRow">
          <span class="hudLabel">Sel:</span>
          <span class="hudValue" id="transposeHint">Select keys</span>
        </div>
          <div class="hudRow">
            <span class="hudLabel">Export:</span>
            <span class="hudValue" id="exportNameText">â€”</span>
          </div>
      </div>
    </div>
  </div>
  <button class="ghost" id="btnClear" type="button">Clear</button>
</header>

  <main class="wrap">

      <!-- Piano keyboard container (required by js/main.js) -->
      <section class="pianoContainer">
        <div id="pianoScroll" class="pianoScroll">
          <div id="piano" class="piano" aria-label="Piano keyboard"></div>
        </div>
      </section>

      <!-- Calculator-style deck controls placed under piano -->
      <div id="commandDeck" class="deckControls calculatorDeck">
        

        <div class="bankSelector" id="bankSelector">
          <button class="bankBtn" id="btnBankPrev" type="button" aria-label="Previous scale">â—€</button>
          <button class="bankBtn bankCurrent" id="btnBankCurrent" type="button" aria-label="Current scale">C</button>
          <button class="bankBtn" id="btnBankNext" type="button" aria-label="Next scale">â–¶</button>
        </div>

        <div class="transposeCluster" role="group" aria-label="Transpose controls">
          <button class="ctrl mini accent" id="btnDown" type="button" aria-label="Transpose down">â–¼</button>
          <button class="ctrl mini transposeKey" id="transposeKeyText" type="button" aria-label="Current transpose key">C</button>
          <button class="ctrl mini accent" id="btnUp" type="button" aria-label="Transpose up">â–²</button>
        </div>

        <div class="cluster octaveAltCluster">
          <button class="ctrl mini" id="btnPlus" type="button" aria-label="Invert up">â†¥</button>
          <button class="ctrl mini" id="btnMinus" type="button" aria-label="Invert down">â†§</button>
          <button class="ctrl mini" id="btnAlternates" type="button" aria-label="Alternate chords">â‰ˆ</button>
          <button class="ctrl mini" id="btnUndo" type="button" aria-label="Undo alternate chord" hidden>â†¶</button>
        </div>
      </div>

      <div class="memoryStrip" id="memoryGrid" role="group" aria-label="12 chord memory slots">
        <button class="memBtn" type="button" data-slot="0" aria-label="Memory slot 1">1</button>
        <button class="memBtn" type="button" data-slot="1" aria-label="Memory slot 2">2</button>
        <button class="memBtn" type="button" data-slot="2" aria-label="Memory slot 3">3</button>
        <button class="memBtn" type="button" data-slot="3" aria-label="Memory slot 4">4</button>
        <button class="memBtn" type="button" data-slot="4" aria-label="Memory slot 5">5</button>
        <button class="memBtn" type="button" data-slot="5" aria-label="Memory slot 6">6</button>
        <button class="memBtn" type="button" data-slot="6" aria-label="Memory slot 7">7</button>
        <button class="memBtn" type="button" data-slot="7" aria-label="Memory slot 8">8</button>
        <button class="memBtn" type="button" data-slot="8" aria-label="Memory slot 9">9</button>
        <button class="memBtn" type="button" data-slot="9" aria-label="Memory slot 10">10</button>
        <button class="memBtn" type="button" data-slot="10" aria-label="Memory slot 11">11</button>
        <button class="memBtn" type="button" data-slot="11" aria-label="Memory slot 12">12</button>
      </div>
    </section>

    <footer class="footer" id="footer">
      <span id="status">Offline-ready.</span>
    </footer>

  </main>
  <!-- ===== MENU MODAL ===== -->
  <div class="modal" id="menuModal" hidden>
    <div class="modalOverlay" data-close="menuModal"></div>
    <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="menuTitle">
      <div class="modalHead">
        <div class="modalTitle" id="menuTitle">Menu</div>
        <button class="ghost" type="button" data-close="menuModal" aria-label="Close">âœ•</button>
      </div>

      <div class="modalSection">
        <div class="modalLabel">Scale</div>
        <button class="ghost" type="button" id="btnPickScale">Pick / Manage Scales</button>
        <div class="modalHint" id="scaleHint">Used for choosing which scale bank your chords save into.</div>
      </div>

      <div class="modalSection">
        <div class="modalLabel">Chord Memory</div>
        <button class="ghost" type="button" id="btnOpenMemory">Open Memory Manager</button>
        <div class="modalHint">Store up to 12 chords with their scale. Slots update when you transpose.</div>
      </div>

      <div class="modalSection">
        <div class="modalLabel">Backup & Share</div>
        <div class="actionRow">
          <button class="ghost" type="button" id="btnExport">Export Data</button>
          <button class="ghost" type="button" id="btnImport">Import Data</button>
        </div>
        <div class="modalHint">Backup your chord banks to a file or restore from a previous backup.</div>
        <input type="file" id="fileInput" accept=".json" class="hiddenFileInput" />
      </div>

      <div class="modalSection">
        <div class="modalLabel">Help</div>
        <button class="ghost" type="button" id="btnHelp">How to Use This App</button>
        <div class="modalHint">Learn about controls and features.</div>
      </div>
    </div>
  </div>

  <!-- ===== MEMORY MODAL ===== -->
  <div class="modal" id="memoryModal" hidden>
    <div class="modalOverlay" data-close="memoryModal"></div>
    <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="memoryTitle">
      <div class="modalHead">
        <div class="modalTitle" id="memoryTitle">Chord Memory</div>
        <button class="ghost" type="button" data-close="memoryModal" aria-label="Close">âœ•</button>
      </div>

      <div class="modalSection">
        <div class="modalLabel">Save chord</div>
        <div class="modalHint">Select notes on the keyboard, choose a scale, then tap a slot.</div>
        <div class="memoryGrid" id="memoryGridModal" role="group" aria-label="Memory slots (modal)"></div>
      </div>

      <div class="modalSection">
        <div class="modalLabel">Scale</div>
        <div class="scalePickerRow">
          <select id="scaleSelect" aria-label="Select scale"></select>
          <button class="ghost" type="button" id="btnScaleAdd">Add</button>
          <!-- Scale banks are fixed (12 keys). Removing scales is disabled. -->
        </div>
        <div class="modalHint" id="scaleListHint">Scales save locally on this device.</div>
      </div>

      <div class="modalSection">
        <div class="modalLabel">Slot actions</div>
        <div class="actionRow">
          <button class="ghost" type="button" id="btnSlotLoad">Load</button>
          <button class="ghost" type="button" id="btnSlotClear">Clear</button>
        </div>
        <div class="modalHint" id="slotHint">Load a chord to practice it, then transpose to move it through keys.</div>
      </div>
    </div>
  </div>

  <!-- ===== CUSTOM PROMPT MODAL ===== -->
  <div class="modal" id="promptModal" hidden>
    <div class="modalOverlay" data-close="promptModal"></div>
    <div class="modalCard promptCard" role="dialog" aria-modal="true" aria-labelledby="promptTitle">
      <div class="modalHead">
        <div class="modalTitle" id="promptTitle">Name this chord</div>
        <button class="ghost" type="button" data-close="promptModal" aria-label="Close">âœ•</button>
      </div>
      <div class="modalSection">
        <input type="text" id="promptInput" class="promptInput" placeholder="Enter chord name" />
      </div>
      <div class="modalSection promptActions">
        <button class="ghost" type="button" data-close="promptModal">Cancel</button>
        <button class="ghost accent" type="button" id="promptOk">OK</button>
      </div>
    </div>
  </div>

  <!-- ===== ALTERNATE CHORDS MODAL ===== -->
  <div class="modal" id="alternatesModal" hidden>
    <div class="modalOverlay" data-close="alternatesModal"></div>
    <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="alternatesTitle">
      <div class="modalHead">
        <div class="modalTitle" id="alternatesTitle">Alternate Chord Suggestions</div>
        <button class="ghost" type="button" data-close="alternatesModal" aria-label="Close">âœ•</button>
      </div>
      <div class="modalSection">
        <div class="modalHint" id="alternatesHint">Similar chords and voicings you can try:</div>
        <div id="alternatesList" class="alternatesList"></div>
      </div>
    </div>
  </div>

  <!-- ===== HELP MODAL ===== -->
  <div class="modal" id="helpModal" hidden>
    <div class="modalOverlay" data-close="helpModal"></div>
    <div class="modalCard helpCard" role="dialog" aria-modal="true" aria-labelledby="helpTitle">
      <div class="modalHead">
        <div class="modalTitle" id="helpTitle">How to Use Piano Chord Transposer</div>
        <button class="ghost" type="button" data-close="helpModal" aria-label="Close">âœ•</button>
      </div>
      
      <div class="modalSection">
        <div class="helpSectionTitle">ðŸŽ¹ Piano Keyboard</div>
        <div class="helpText">
          <strong>Tap keys</strong> to select notes. Selected keys light up in green.
          <br>Use <strong>âˆ’ / +</strong> buttons to change the number of visible octaves.
        </div>
      </div>

      <div class="modalSection">
        <div class="helpSectionTitle">ðŸŽµ Transposing</div>
        <div class="helpText">
          Select notes, then use <strong>â–²</strong> (up) or <strong>â–¼</strong> (down) to transpose by semitone.
          <br>Your selected notes move together while staying in the keyboard range.
        </div>
      </div>

      <div class="modalSection">
        <div class="helpSectionTitle">â‰ˆ Alternate Chords</div>
        <div class="helpText">
          Select a chord and tap <strong>â‰ˆ</strong> to see suggestions:
          <br>â€¢ Inversions (1st, 2nd)
          <br>â€¢ Extensions (7th, 9th, 11th)
          <br>â€¢ Suspended chords (sus2, sus4)
          <br>â€¢ Relative major/minor
          <br><br>Tap <strong>Apply</strong> to use any suggestion. The <strong>â†¶</strong> button appears to undo (up to 5 steps).
        </div>
      </div>

      <div class="modalSection">
        <div class="helpSectionTitle">ðŸ’¾ Chord Memory</div>
        <div class="helpText">
          <strong>12 scale banks</strong> (C through B), each with <strong>12 chord slots</strong>.
          <br>â€¢ Use bank arrows <strong>â—€ â–¶</strong> to switch between scales
          <br>â€¢ Tap a slot to save the current chord
          <br>â€¢ Tap again to load a saved chord
          <br>â€¢ Open Menu â†’ Chord Memory to manage slots
        </div>
      </div>

      <div class="modalSection">
        <div class="helpSectionTitle">ðŸ’¾ Backup & Share</div>
        <div class="helpText">
          <strong>Export Data:</strong> Download all your chord banks as a JSON file
          <br>â€¢ Backs up all 12 scale banks with saved chords
          <br>â€¢ Save to cloud storage or share with others
          <br><br><strong>Import Data:</strong> Restore from a previous backup
          <br>â€¢ Select a previously exported JSON file
          <br>â€¢ Replaces current data (backup first!)
          <br>â€¢ Perfect for syncing across devices
        </div>
      </div>

      <div class="modalSection">
        <div class="helpSectionTitle">âš¡ Quick Tips</div>
        <div class="helpText">
          â€¢ Tap <strong>Clear</strong> to deselect all notes
          <br>â€¢ The app auto-detects and names chords
          <br>â€¢ Custom name chords when saving to memory
          <br>â€¢ Works offline when installed as a PWA
          <br>â€¢ All data saved locally on your device
        </div>
      </div>
    </div>
  </div>

  <!-- Load modules in dependency order -->
  <script src="js/utils.js"></script>
  <script src="js/chordDetection.js"></script>
  <script src="js/chordAlternates.js"></script>
  <script src="js/main.js"></script>
</body>
</html>
